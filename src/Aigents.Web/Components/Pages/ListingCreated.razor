@page "/listing-created"
@rendermode @(new InteractiveServerRenderMode(prerender: true))
@using Microsoft.AspNetCore.Components.Web
@inject NavigationManager Navigation
@using Aigents.Web.Services
@using Aigents.Domain.Entities
@inject IListingService ListingService

<PageTitle>Listing Created! | aigents</PageTitle>

<div class="success-wrapper">
    <div class="success-bg"></div>
    
    <div class="success-content animate-scale-up">
        <div class="success-header">
            <div class="success-icon">üéâ</div>
            <div class="header-text">
                <h1>Your listing is live!</h1>
                <p class="success-message">
                    Your property is now visible to verified agents. We're also broadcasting 
                    it to global property portals.
                </p>
            </div>
        </div>
        
        <div class="success-grid">
            <div class="success-left">
                <div class="listing-preview">
                    <div class="preview-image"></div>
                    <div class="preview-info">
                        @if (_listing != null)
                        {
                            <h3>@_listing.Address</h3>
                            <p>@_listing.Suburb, @_listing.State @_listing.Postcode</p>
                            <div class="preview-stats">
                                <span>@_listing.Bedrooms bed</span>
                                <span>@_listing.Bathrooms bath</span>
                                <span>@_listing.CarSpaces car</span>
                            </div>
                        }
                        else
                        {
                            <h3>Loading listing...</h3>
                            <div class="preview-stats">
                                <span style="width: 100px; height: 16px; background: #e5e7eb; display: block; border-radius: 4px;"></span>
                            </div>
                        }
                        <div class="preview-status">
                            <span class="status-dot"></span>
                            Live ‚Ä¢ Global Broadcast Active
                        </div>
                    </div>
                </div>
                
                <div class="next-steps">
                    <h4>What happens next?</h4>
                    <div class="steps-list">
                        <div class="next-step">
                            <span class="step-time">Now</span>
                            <span class="step-desc">Your listing is live on the global marketplace</span>
                        </div>
                        <div class="next-step">
                            <span class="step-time">24-48 hrs</span>
                            <span class="step-desc">Buyer interest & agent proposals start arriving</span>
                        </div>
                        <div class="next-step">
                            <span class="step-time">As they come</span>
                            <span class="step-desc">You'll be notified of new offers</span>
                        </div>
                    </div>
                </div>
                
                <div class="success-actions">
                    <button class="primary-btn" @onclick="GoToDashboard">
                        View My Listing
                        <span class="btn-arrow">‚Üí</span>
                    </button>
                    <button class="secondary-btn" @onclick="GoHome">
                        Back to Home
                    </button>
                </div>
            </div>
            
            <div class="success-right">
                <div class="globe-wrapper">
                    <div class="globe-label">Live Broadcast Output</div>
                    <GlobeSyndication />
                </div>
            </div>
        </div>
        
        <div class="share-section">
            <p>Share your listing:</p>
            <div class="share-buttons">
                <button class="share-btn">üìã Copy Link</button>
                <button class="share-btn">üì± SMS</button>
                <button class="share-btn">‚úâÔ∏è Email</button>
            </div>
        </div>
    </div>
</div>

<style>
@@import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap');

.success-wrapper {
    font-family: 'Inter', -apple-system, BlinkMacSystemFont, sans-serif;
    background: #fafafa;
    min-height: 100vh;
    display: flex;
    align-items: center;
    justify-content: center;
    padding: 40px 24px;
    -webkit-font-smoothing: antialiased;
}

.success-bg {
    position: fixed;
    inset: 0;
    background: 
        radial-gradient(ellipse 80% 50% at 50% -20%, rgba(16, 185, 129, 0.15), transparent),
        radial-gradient(ellipse 60% 50% at 80% 50%, rgba(16, 185, 129, 0.08), transparent);
    pointer-events: none;
}

.success-content {
    position: relative;
    background: white;
    border-radius: 28px;
    padding: 0; /* Removing padding from container to let children handle it */
    max-width: 1000px; /* Increased width */
    width: 100%;
    box-shadow: 0 24px 80px rgba(0, 0, 0, 0.08);
    border: 1px solid rgba(0, 0, 0, 0.04);
    overflow: hidden;
}

.success-header {
    text-align: center;
    padding: 40px 40px 20px 40px;
    border-bottom: 1px solid #f3f4f6;
    background: #fcfcfc;
}

.success-icon {
    font-size: 56px;
    margin-bottom: 16px;
    animation: bounce 0.6s ease;
}

@@keyframes bounce {
    0%, 100% { transform: translateY(0); }
    50% { transform: translateY(-10px); }
}

.success-header h1 {
    font-size: 32px;
    font-weight: 800;
    color: #1a1a2e;
    margin: 0 0 12px 0;
}

.success-message {
    font-size: 16px;
    color: #6b7280;
    line-height: 1.6;
    max-width: 500px;
    margin: 0 auto;
}

.success-grid {
    display: grid;
    grid-template-columns: 1fr 1fr;
    gap: 0;
}

.success-left {
    padding: 40px;
}

.success-right {
    background: #000;
    position: relative;
    overflow: hidden;
    display: flex;
    flex-direction: column;
}

.globe-wrapper {
    position: relative;
    flex: 1;
    min-height: 400px;
}

/* Adjust globe container within the wrapper */
.globe-wrapper ::deep .globe-container {
    margin-bottom: 0 !important;
    border-radius: 0 !important;
    box-shadow: none !important;
    height: 100% !important;
    background: transparent !important;
}

/* Override the hardcoded height from the component if possible, 
   but since it's inline style on the id element, we might need JS or just rely on it.
   The component has style="width: 100%; height: 500px;" on #broadcast-globe.
   We can try to force it or just let it be. 500px is fine.
*/

.globe-label {
    position: absolute;
    top: 20px;
    right: 20px;
    background: rgba(255, 255, 255, 0.1);
    color: rgba(255, 255, 255, 0.8);
    font-size: 11px;
    text-transform: uppercase;
    letter-spacing: 1px;
    padding: 6px 12px;
    border-radius: 20px;
    z-index: 10;
    pointer-events: none;
    border: 1px solid rgba(255, 255, 255, 0.1);
}

.listing-preview {
    display: flex;
    gap: 20px;
    padding: 20px;
    background: #f8fafc;
    border-radius: 16px;
    text-align: left;
    margin-bottom: 32px;
    border: 1px solid #edf2f7;
}

.preview-image {
    width: 90px;
    height: 90px;
    background: linear-gradient(135deg, #10b981, #059669);
    border-radius: 12px;
    flex-shrink: 0;
}

.preview-info h3 {
    font-size: 17px;
    font-weight: 700;
    color: #1a1a2e;
    margin: 0 0 4px 0;
}

.preview-info p {
    font-size: 14px;
    color: #6b7280;
    margin: 0 0 12px 0;
}

.preview-stats {
    display: flex;
    gap: 12px;
    margin-bottom: 10px;
}

.preview-stats span {
    font-size: 12px;
    color: #4b5563;
    padding: 3px 8px;
    background: white;
    border-radius: 6px;
    border: 1px solid #e5e7eb;
}

.preview-status {
    display: flex;
    align-items: center;
    gap: 6px;
    font-size: 13px;
    color: #10b981;
    font-weight: 600;
}

.status-dot {
    width: 8px;
    height: 8px;
    background: #10b981;
    border-radius: 50%;
    animation: pulse 2s infinite;
}

@@keyframes pulse {
    0%, 100% { opacity: 1; }
    50% { opacity: 0.5; }
}

.next-steps {
    text-align: left;
    margin-bottom: 32px;
}

.next-steps h4 {
    font-size: 14px;
    font-weight: 700;
    color: #1a1a2e;
    margin: 0 0 16px 0;
    text-transform: uppercase;
    letter-spacing: 0.5px;
}

.steps-list {
    display: flex;
    flex-direction: column;
    gap: 16px;
    position: relative;
    padding-left: 12px;
}

.steps-list::before {
    content: '';
    position: absolute;
    left: 0;
    top: 8px;
    bottom: 8px;
    width: 2px;
    background: #e5e7eb;
}

.next-step {
    display: flex;
    gap: 16px;
    align-items: baseline;
    position: relative;
}

.next-step::before {
    content: '';
    position: absolute;
    left: -17px; /* Adjust based on line position */
    top: 6px;
    width: 8px;
    height: 8px;
    background: #fff;
    border: 2px solid #10b981;
    border-radius: 50%;
    z-index: 2;
}

.step-time {
    font-size: 12px;
    font-weight: 700;
    color: #10b981;
    min-width: 70px;
}

.step-desc {
    font-size: 14px;
    color: #4b5563;
}

.success-actions {
    display: flex;
    flex-direction: column;
    gap: 12px;
    margin-bottom: 0;
}

.primary-btn {
    display: flex;
    align-items: center;
    justify-content: center;
    gap: 10px;
    width: 100%;
    padding: 16px 24px;
    background: linear-gradient(135deg, #10b981, #059669);
    color: white;
    border: none;
    border-radius: 12px;
    font-size: 16px;
    font-weight: 700;
    cursor: pointer;
    transition: all 0.3s;
    font-family: inherit;
}

.primary-btn:hover {
    transform: translateY(-2px);
    box-shadow: 0 8px 24px rgba(16, 185, 129, 0.35);
}

.btn-arrow {
    font-size: 18px;
}

.secondary-btn {
    padding: 14px 24px;
    background: transparent;
    color: #6b7280;
    border: 2px solid rgba(0, 0, 0, 0.08);
    border-radius: 12px;
    font-size: 15px;
    font-weight: 600;
    cursor: pointer;
    transition: all 0.2s;
    font-family: inherit;
}

.secondary-btn:hover {
    border-color: #1a1a2e;
    color: #1a1a2e;
}

.share-section {
    padding: 24px;
    border-top: 1px solid #f3f4f6;
    background: #fcfcfc;
    text-align: center;
}

.share-section p {
    font-size: 14px;
    color: #9ca3af;
    margin-bottom: 12px;
    display: inline-block;
    margin-right: 12px;
}

.share-buttons {
    display: inline-flex;
    justify-content: center;
    gap: 10px;
    vertical-align: middle;
}

.share-btn {
    padding: 8px 16px;
    background: white;
    border: 1px solid rgba(0, 0, 0, 0.08);
    border-radius: 8px;
    font-size: 13px;
    font-weight: 600;
    color: #4b5563;
    cursor: pointer;
    transition: all 0.2s;
    font-family: inherit;
}

.share-btn:hover {
    border-color: #10b981;
    color: #10b981;
}

/* Animation */
.animate-scale-up {
    animation: scaleUp 0.5s cubic-bezier(0.16, 1, 0.3, 1) forwards;
}

@@keyframes scaleUp {
    from {
        opacity: 0;
        transform: scale(0.95) translateY(20px);
    }
    to {
        opacity: 1;
        transform: scale(1) translateY(0);
    }
}

/* Responsive */
@@media (max-width: 900px) {
    .success-grid {
        grid-template-columns: 1fr;
    }
    
    .success-right {
        order: -1; /* Show map first on mobile? Or second? Second is better for context */
        order: 0;
        min-height: 400px;
    }
    
    .listing-preview {
        flex-direction: column;
        align-items: center;
        text-align: center;
    }
    
    .preview-stats {
        justify-content: center;
    }
    
    .preview-status {
        justify-content: center;
    }
    
    .share-section {
        display: flex;
        flex-direction: column;
    }
    
    .share-section p {
        margin-right: 0;
        margin-bottom: 16px;
    }
    
    .share-buttons {
        flex-direction: row;
        width: 100%;
    }
    
    .share-btn {
        flex: 1;
    }
}
</style>

@code {
    [SupplyParameterFromQuery]
    public Guid? Id { get; set; }

    private Listing? _listing;

    protected override async Task OnInitializedAsync()
    {
        if (Id.HasValue)
        {
            _listing = await ListingService.GetListingAsync(Id.Value);
        }
    }

    private void GoToDashboard()
    {
        if (_listing?.User != null)
        {
            Navigation.NavigateTo($"/my-listings?email={_listing.User.Email}");
        }
        else
        {
            Navigation.NavigateTo("/my-listings");
        }
    }
    
    private void GoHome()
    {
        Navigation.NavigateTo("/");
    }
}
